<view class="container">
  <view class="header">
    <text class="title">è®¢å•ç¡®è®¤</text>
  </view>

  <view class="order-type">
    <view 
      wx:if="{{serviceModes && serviceModes.includes(1)}}"
      class="type-item {{orderType === 1 ? 'active' : ''}}" 
      bindtap="selectOrderType"
      data-type="1"
    >
      <view class="type-icon">ğŸ›µï¸</view>
      <view class="type-text">å¤–å–</view>
      <view class="type-info" wx:if="{{merchant.minDeliveryAmount}}">èµ·é€Â¥{{merchant.minDeliveryAmount}}</view>
    </view>
    <view 
      wx:if="{{serviceModes && serviceModes.includes(2)}}"
      class="type-item {{orderType === 2 ? 'active' : ''}}" 
      bindtap="selectOrderType"
      data-type="2"
    >
      <view class="type-icon">ğŸ¥¡</view>
      <view class="type-text">è‡ªå–</view>
      <view class="type-info" wx:if="{{merchant.minTakeoutAmount}}">èµ·è´­Â¥{{merchant.minTakeoutAmount}}</view>
    </view>
  </view>

  <view wx:if="{{orderType === 1}}" class="address-section">
    <view class="section-title">æ”¶è´§åœ°å€</view>
    <view wx:if="{{selectedAddress}}" class="address-card" bindtap="selectAddress">
      <view class="address-header">
        <text class="receiver-name">{{selectedAddress.receiverName}}</text>
        <text class="receiver-phone">{{selectedAddress.receiverPhone}}</text>
      </view>
      <view class="address-detail">
        <text>{{selectedAddress.province}}{{selectedAddress.city}}{{selectedAddress.district}}</text>
        <text>{{selectedAddress.detailAddress}}</text>
      </view>
      <view class="change-address">ç‚¹å‡»æ›´æ¢åœ°å€</view>
    </view>
    <view wx:else class="address-empty" bindtap="selectAddress">
      <text class="add-icon">+</text>
      <text class="add-text">æ·»åŠ æ”¶è´§åœ°å€</text>
    </view>
  </view>

  <view wx:if="{{orderType === 1 && deliveryTypes.length > 1}}" class="delivery-type-section">
    <view class="section-title">é…é€æ–¹å¼</view>
    <view class="delivery-type-list">
      <view 
        class="delivery-type-item {{deliveryType === 'immediate' ? 'active' : ''}}" 
        bindtap="selectDeliveryType"
        data-type="immediate"
      >
        <view class="type-icon">âš¡</view>
        <view class="type-name">ç«‹å³é…é€</view>
        <view class="type-desc">é¢„è®¡{{estimatedDeliveryTime}}é€è¾¾</view>
      </view>
      <view 
        class="delivery-type-item {{deliveryType === 'reserve' ? 'active' : ''}}" 
        bindtap="selectDeliveryType"
        data-type="reserve"
      >
        <view class="type-icon">ğŸ•</view>
        <view class="type-name">é¢„çº¦é…é€</view>
        <view class="type-desc">é€‰æ‹©é…é€æ—¶é—´</view>
      </view>
    </view>
  </view>

  <view wx:if="{{orderType === 1 && deliveryType === 'reserve'}}" class="reserve-time-section">
    <view class="section-title">é€‰æ‹©é…é€æ—¶é—´</view>
    <picker mode="multiSelector" range="{{timeRange}}" range-key="label" bindchange="onTimeChange" bindcolumnchange="onTimeColumnChange" value="{{timeIndex}}">
      <view class="reserve-time-picker">
        <text class="time-label">é…é€æ—¶é—´ï¼š</text>
        <text class="time-value">{{selectedTime || 'è¯·é€‰æ‹©é…é€æ—¶é—´'}}</text>
        <text class="time-arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <view wx:if="{{orderType === 2}}" class="takeout-info-section">
    <view class="section-title">å–é¤ä¿¡æ¯</view>
    <view class="takeout-info-card">
      <view class="info-row">
        <text class="info-label">å–é¤åœ°å€</text>
        <text class="info-value">{{merchant.address}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">è”ç³»ç”µè¯</text>
        <text class="info-value">{{merchant.phone}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">é¢„è®¡å–é¤æ—¶é—´</text>
        <text class="info-value">{{merchant.takeoutTime}}</text>
      </view>
    </view>
  </view>

  <view class="cart-list">
    <view class="cart-item" wx:for="{{cart}}" wx:key="id">
      <image class="item-image" src="{{item.imageUrl || '/images/default-dish.png'}}" mode="aspectFill"></image>
      <view class="item-info">
        <view class="item-name">{{item.name}}</view>
        <view class="item-price">Â¥{{item.price}}</view>
      </view>
      <view class="item-quantity">x{{item.quantity}}</view>
    </view>
  </view>

  <view class="remark-section">
    <view class="section-title">å¤‡æ³¨</view>
    <textarea 
      class="remark-input" 
      placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼Œå¦‚ï¼šå°‘è¾£ã€ä¸è¦é¦™èœç­‰"
      value="{{remark}}"
      bindinput="onRemarkInput"
      maxlength="100"
    ></textarea>
  </view>

  <view class="footer">
    <view class="total-info">
      <text class="total-label">å…±{{cartCount}}ä»¶</text>
      <text class="total-amount">åˆè®¡ï¼šÂ¥{{cartTotal}}</text>
    </view>
    <button class="submit-btn" bindtap="submitOrder">æäº¤è®¢å•</button>
  </view>
</view>
