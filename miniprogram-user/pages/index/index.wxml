<view class="container">
  <view class="header">
    <view class="location-bar" bindtap="chooseLocation">
      <text class="location-icon">ğŸ“</text>
      <text class="location-text">{{location || 'è·å–å®šä½ä¸­...'}}</text>
      <text class="location-arrow">â–¼</text>
    </view>
    <view class="search-bar" bindtap="goToSearch">
      <text class="search-icon">ğŸ”</text>
      <text class="search-placeholder">æœç´¢å•†å®¶ã€å•†å“åç§°</text>
    </view>
  </view>

  <view class="category-bar">
    <scroll-view class="category-scroll" scroll-x="true" show-scrollbar="false">
      <view 
        class="category-item {{currentCategory === item ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="*this"
        bindtap="changeCategory"
        data-category="{{item}}"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>

  <view class="sort-bar">
    <view 
      class="sort-item {{sortType === 'comprehensive' ? 'active' : ''}}" 
      bindtap="changeSortType"
      data-type="comprehensive"
    >
      ç»¼åˆæ’åº
    </view>
    <view 
      class="sort-item {{sortType === 'sales' ? 'active' : ''}}" 
      bindtap="changeSortType"
      data-type="sales"
    >
      é”€é‡æœ€é«˜
    </view>
    <view 
      class="sort-item {{sortType === 'distance' ? 'active' : ''}}" 
      bindtap="changeSortType"
      data-type="distance"
    >
      è·ç¦»æœ€è¿‘
    </view>
    <view class="sort-item" bindtap="showFilter">
      ç­›é€‰
      <text class="filter-icon">âš™ï¸</text>
    </view>
  </view>

  <view class="merchant-list">
    <view 
      class="merchant-card" 
      wx:for="{{merchantList}}" 
      wx:key="id"
      bindtap="goToMerchantDetail"
      data-id="{{item.id}}"
    >
      <view class="merchant-card-content">
        <image class="merchant-logo" src="{{item.logoUrl || '/images/default-merchant.png'}}" mode="aspectFill"></image>
        <view class="merchant-info">
          <view class="info-row1">
            <text class="merchant-name">{{item.name}}</text>
            <view class="reserve-tag {{item.canReserve ? '' : 'disable'}}">
              {{item.canReserve ? 'é¢„å®š' : 'ä¸å¯é¢„å®š'}}
            </view>
          </view>
          <view class="info-row2">
            <text class="rating">â­ {{item.rating}}</text>
            <text class="month-sales">æœˆå”®{{item.monthSales}}</text>
            <text class="per-capita">äººå‡Â¥{{item.perCapita}}</text>
          </view>
          <view class="info-row3">
            <text class="min-order">èµ·é€Â¥{{item.minOrder}}</text>
            <text class="delivery-fee">é…é€Â¥{{item.deliveryFee}}</text>
          </view>
          <view class="info-row4" wx:if="{{item.salesRank || item.hasCoupon}}">
            <text class="sales-rank" wx:if="{{item.salesRank}}">é”€é‡ç¬¬{{item.salesRank}}</text>
            <view class="coupon-tag" wx:if="{{item.hasCoupon}}" bindtap="receiveCoupon" catchtap="receiveCoupon" data-id="{{item.id}}">
              {{item.couponReceived ? 'å·²é¢†å–' : 'ç¥åˆ¸'}}
            </view>
          </view>
          <view class="info-row5">
            <text class="delivery-time">{{item.deliveryTime}}åˆ†é’Ÿ</text>
            <text class="distance">{{item.distance}}km</text>
          </view>
        </view>
      </view>
      <view class="hot-dishes-area" wx:if="{{item.hotDishes && item.hotDishes.length > 0}}">
        <text class="hot-dishes-title">æœ€çƒ­èœå“</text>
        <view class="dishes-list">
          <view 
            class="dish-item" 
            wx:for="{{item.hotDishes}}" 
            wx:key="id"
            wx:for-item="dish"
            bindtap="goToDishDetail"
            catchtap="goToDishDetail"
            data-merchant-id="{{item.id}}"
            data-dish-id="{{dish.id}}"
          >
            <image class="dish-img" src="{{dish.imageUrl || '/images/default-dish.png'}}" mode="aspectFill"></image>
            <text class="dish-name">{{dish.name}}</text>
            <text class="dish-price">Â¥{{dish.price}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:if="{{merchantList.length === 0 && !loading}}">
    <text class="empty-icon">ğŸª</text>
    <text class="empty-text">æš‚æ— å•†å®¶</text>
    <view class="retry-btn" bindtap="getMerchantList">é‡æ–°åŠ è½½</view>
  </view>

  <view class="loading-more" wx:if="{{loadingMore}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view class="no-more" wx:if="{{!hasMore && merchantList.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>