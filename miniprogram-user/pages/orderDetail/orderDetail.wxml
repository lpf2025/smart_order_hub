<view class="container" wx:if="{{order}}">
  <view class="order-status-card">
    <view class="status-icon">
      <text class="icon">âœ“</text>
    </view>
    <view class="status-text">{{getStatusText(order.status)}}</view>
    <view class="status-time">{{order.createdAt}}</view>
  </view>

  <view class="delivery-address-card" wx:if="{{address && order.orderType === 1}}">
    <view class="card-title">é…é€ä¿¡æ¯</view>
    <view class="address-info">
      <view class="receiver-info">
        <text class="receiver-name">{{address.receiverName}}</text>
        <text class="receiver-phone">{{maskPhone(address.receiverPhone)}}</text>
      </view>
      <view class="address-detail">
        {{address.province}}{{address.city}}{{address.district}}{{address.detailAddress}}
      </view>
    </view>
  </view>

  <view class="takeout-info-card" wx:if="{{order.orderType === 2}}">
    <view class="card-title">å–é¤ä¿¡æ¯</view>
    <view class="takeout-info">
      <view class="info-row">
        <text class="info-label">å–é¤åœ°å€</text>
        <text class="info-value">{{merchant.address}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">è”ç³»ç”µè¯</text>
        <text class="info-value">{{merchant.phone}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">é¢„è®¡å–é¤æ—¶é—´</text>
        <text class="info-value">{{merchant.takeoutTime}}</text>
      </view>
    </view>
  </view>

  <view class="delivery-status-card" wx:if="{{order.orderType === 1}}">
    <view class="card-title">é…é€çŠ¶æ€</view>
    <view class="delivery-status-list">
      <view class="status-item {{order.status >= 1 ? 'active' : ''}}">
        <view class="status-dot"></view>
        <view class="status-label">å¾…æ¥å•</view>
      </view>
      <view class="status-item {{order.status >= 2 ? 'active' : ''}}">
        <view class="status-dot"></view>
        <view class="status-label">å¾…å‡ºé¤</view>
      </view>
      <view class="status-item {{order.status >= 3 ? 'active' : ''}}">
        <view class="status-dot"></view>
        <view class="status-label">å¾…é…é€</view>
      </view>
      <view class="status-item {{order.status >= 4 ? 'active' : ''}}">
        <view class="status-dot"></view>
        <view class="status-label">é…é€ä¸­</view>
      </view>
      <view class="status-item {{order.status >= 5 ? 'active' : ''}}">
        <view class="status-dot"></view>
        <view class="status-label">å·²å®Œæˆ</view>
      </view>
    </view>
  </view>

  <view class="order-info-card">
    <view class="card-title">è®¢å•ä¿¡æ¯</view>
    <view class="info-row">
      <text class="info-label">è®¢å•å·</text>
      <text class="info-value">{{order.orderNo}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">é…é€æœåŠ¡</text>
      <text class="info-value">{{order.orderType === 1 ? 'å•†å®¶é…é€' : 'è‡ªå–'}}</text>
    </view>
    <view class="info-row" wx:if="{{order.orderType === 1}}">
      <text class="info-label">é…é€æ–¹å¼</text>
      <text class="info-value">{{order.deliveryType === 'immediate' ? 'ç«‹å³é…é€' : 'é¢„çº¦é…é€'}}</text>
    </view>
    <view class="info-row" wx:if="{{order.deliveryNo}}">
      <text class="info-label">é…é€å•å·</text>
      <text class="info-value">{{order.deliveryNo}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">ä¸‹å•æ—¶é—´</text>
      <text class="info-value">{{order.createdAt}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">æ”¯ä»˜æ–¹å¼</text>
      <text class="info-value">{{order.payMethod === 'wechat' ? 'å¾®ä¿¡æ”¯ä»˜' : (order.payMethod === 'alipay' ? 'æ”¯ä»˜å®' : 'æœªçŸ¥')}}</text>
    </view>
    <view class="info-row" wx:if="{{order.orderType === 1 && order.deliveryType === 'reserve' && order.reserveTime}}">
      <text class="info-label">é¢„çº¦é…é€æ—¶é—´</text>
      <text class="info-value">{{order.reserveTime}}</text>
    </view>
    <view class="info-row" wx:if="{{order.remark}}">
      <text class="info-label">å¤‡æ³¨</text>
      <text class="info-value">{{order.remark}}</text>
    </view>
  </view>

  <view class="order-items-card">
    <view class="card-title">è®¢å•æ˜ç»†</view>
    <view class="item-list">
      <view class="item-row" wx:for="{{orderItems}}" wx:key="id">
        <view class="item-info">
          <view class="item-name">{{item.dishName}}</view>
          <view class="item-spec" wx:if="{{item.specName}}">{{item.specName}}</view>
        </view>
        <view class="item-quantity">x{{item.quantity}}</view>
        <view class="item-price">Â¥{{item.subtotal}}</view>
      </view>
    </view>
  </view>

  <view class="order-summary-card">
    <view class="summary-row">
      <text class="summary-label">è®¢å•æ€»é¢</text>
      <text class="summary-value total">Â¥{{order.totalAmount}}</text>
    </view>
    <view class="summary-row">
      <text class="summary-label">æ”¯ä»˜çŠ¶æ€</text>
      <text class="summary-value">{{order.payStatus === 1 ? 'å·²æ”¯ä»˜' : 'æœªæ”¯ä»˜'}}</text>
    </view>
  </view>

  <view class="order-actions" wx:if="{{order.status === 1 && order.payStatus === 0}}">
    <view class="action-btn cancel" bindtap="cancelOrder">å–æ¶ˆè®¢å•</view>
    <view class="action-btn primary" bindtap="showPayModal">å»æ”¯ä»˜</view>
  </view>
</view>

<view class="pay-modal" wx:if="{{showPayModal}}" bindtap="hidePayModal">
  <view class="pay-content" catchtap="stopPropagation">
    <view class="pay-header">
      <text class="pay-title">é€‰æ‹©æ”¯ä»˜æ–¹å¼</text>
      <text class="pay-close" bindtap="hidePayModal">Ã—</text>
    </view>
    <view class="pay-amount">
      <text class="amount-label">æ”¯ä»˜é‡‘é¢</text>
      <text class="amount-value">Â¥{{order.totalAmount}}</text>
    </view>
    <view class="pay-methods">
      <view 
        class="pay-method-item {{selectedPayMethod === 'wechat' ? 'active' : ''}}" 
        bindtap="selectPayMethod"
        data-method="wechat"
      >
        <view class="pay-method-icon wechat">
          <text class="icon">ğŸ’¬</text>
        </view>
        <view class="pay-method-info">
          <text class="pay-method-name">å¾®ä¿¡æ”¯ä»˜</text>
          <text class="pay-method-desc">æ¨èä½¿ç”¨å¾®ä¿¡æ”¯ä»˜</text>
        </view>
        <view class="pay-method-check">
          <view wx:if="{{selectedPayMethod === 'wechat'}}" class="check-icon">âœ“</view>
        </view>
      </view>
      <view 
        class="pay-method-item {{selectedPayMethod === 'alipay' ? 'active' : ''}}" 
        bindtap="selectPayMethod"
        data-method="alipay"
      >
        <view class="pay-method-icon alipay">
          <text class="icon">ğŸ’°</text>
        </view>
        <view class="pay-method-info">
          <text class="pay-method-name">æ”¯ä»˜å®</text>
          <text class="pay-method-desc">å®‰å…¨å¿«æ·çš„æ”¯ä»˜æ–¹å¼</text>
        </view>
        <view class="pay-method-check">
          <view wx:if="{{selectedPayMethod === 'alipay'}}" class="check-icon">âœ“</view>
        </view>
      </view>
    </view>
    <button class="pay-btn" bindtap="confirmPay" disabled="{{paying}}">
      {{paying ? 'æ”¯ä»˜ä¸­...' : 'ç¡®è®¤æ”¯ä»˜'}}
    </button>
  </view>
</view>

<view class="loading" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>
