<view class="container" wx:if="{{order}}">
  <view class="order-status-card">
    <view class="status-icon">
      <text class="icon">{{getStatusIcon(order.status)}}</text>
    </view>
    <view class="status-text">{{getStatusText(order.status)}}</view>
    <view class="status-time">{{order.createdAtFormatted}}</view>
  </view>

  <view class="order-info-card">
    <view class="card-title">订单信息</view>
    <view class="info-row">
      <text class="info-label">订单号</text>
      <text class="info-value order-no">{{order.orderNo}}</text>
      <text class="copy-btn" bindtap="copyOrderNo">复制</text>
    </view>
    <view class="info-row">
      <text class="info-label">订单类型</text>
      <text class="info-value">{{order.tableNo || '外卖'}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">配送方式</text>
      <text class="info-value">{{order.orderType === 2 ? '商家配送' : '自提'}}</text>
    </view>
    <view class="info-row address-row" wx:if="{{address}}">
      <text class="info-label">配送地址</text>
      <text class="info-value address-text">{{address.province}}{{address.city}}{{address.district}}{{address.detailAddress}} {{address.maskedContact}} {{address.maskedPhone}}</text>
    </view>
    <view class="info-row" wx:if="{{order.orderType === 2}}">
      <text class="info-label">配送骑手</text>
      <text class="info-value">{{delivery ? (delivery.deliveryName || '') + ' ' + (delivery.deliveryPhone || '') : ''}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">下单时间</text>
      <text class="info-value">{{order.createdAtFormatted}}</text>
    </view>
    <view class="info-row" wx:if="{{order.remark}}">
      <text class="info-label">备注</text>
      <text class="info-value">{{order.remark}}</text>
    </view>
  </view>

  <view class="order-items-card">
    <view class="card-title">订单明细</view>
    <view class="item-list">
      <view class="item-row" wx:for="{{orderItems}}" wx:key="id">
        <image class="item-image" src="{{item.dishImage}}" mode="aspectFill" wx:if="{{item.dishImage}}"></image>
        <view class="item-info">
          <view class="item-name">{{item.dishName}}</view>
          <view class="item-spec" wx:if="{{item.specName}}">{{item.specName}}</view>
        </view>
        <view class="item-quantity">x{{item.quantity}}</view>
      </view>
    </view>
  </view>

  <view class="order-summary-card">
    <view class="summary-row">
      <text class="summary-label">订单总额</text>
      <text class="summary-value total">¥{{order.totalAmount}}</text>
    </view>
    <view class="summary-row">
      <text class="summary-label">支付方式</text>
      <text class="summary-value">{{order.payMethod === 1 ? '支付宝' : '微信'}}</text>
    </view>
    <view class="summary-row">
      <text class="summary-label">支付状态</text>
      <text class="summary-value">{{order.payStatus === 1 ? '已支付' : '未支付'}}</text>
    </view>
  </view>

  <view class="order-actions">
    <view class="action-btn print" bindtap="printReceipt">打印小票</view>
    <view 
      class="action-btn primary" 
      wx:if="{{order.status === 1}}"
      bindtap="acceptOrder"
    >接单</view>
    <view 
      class="action-btn primary" 
      wx:if="{{order.status === 2}}"
      bindtap="readyOrder"
    >出餐</view>
    <view 
      class="action-btn primary" 
      wx:if="{{order.status === 3}}"
      bindtap="startDelivery"
    >开始配送</view>
    <view 
      class="action-btn primary" 
      wx:if="{{order.status === 4}}"
      bindtap="completeOrder"
    >完成</view>
  </view>
</view>

<view class="loading" wx:if="{{loading}}">
  <text>加载中...</text>
</view>
