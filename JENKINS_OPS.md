# Jenkins è‡ªåŠ¨éƒ¨ç½²æ“ä½œæ‰‹å†Œ

## ç›®å½•
1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [JenkinsåŸºç¡€é…ç½®](#jenkinsåŸºç¡€é…ç½®)
3. [å‡­æ®ç®¡ç†](#å‡­æ®ç®¡ç†)
4. [åˆ›å»ºéƒ¨ç½²ä»»åŠ¡](#åˆ›å»ºéƒ¨ç½²ä»»åŠ¡)
5. [é…ç½®GitHub Webhook](#é…ç½®github-webhook)
6. [æœåŠ¡å™¨åˆå§‹åŒ–](#æœåŠ¡å™¨åˆå§‹åŒ–)
7. [é¦–æ¬¡æ„å»º](#é¦–æ¬¡æ„å»º)
8. [æ—¥å¸¸æ“ä½œ](#æ—¥å¸¸æ“ä½œ)
9. [é—®é¢˜æ’æŸ¥](#é—®é¢˜æ’æŸ¥)

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

- âœ… Jenkinså·²å®‰è£…å¹¶è¿è¡Œ
- âœ… æœåŠ¡å™¨IPï¼š`106.15.90.212`
- âœ… æœåŠ¡å™¨ç”¨æˆ·ï¼š`root`
- âœ… GitHubä»“åº“ï¼š`https://github.com/lpf2025/smart_order_hub.git`
- âœ… éœ€è¦å‡†å¤‡ï¼šæœåŠ¡å™¨rootå¯†ç 

---

## JenkinsåŸºç¡€é…ç½®

### 1.1 ç™»å½•Jenkins

1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—®Jenkinsåœ°å€ï¼š`http://<JenkinsæœåŠ¡å™¨IP>:8080`
3. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•

### 1.2 å®‰è£…å¿…è¦æ’ä»¶

1. ç‚¹å‡»å·¦ä¾§"Manage Jenkins"
2. ç‚¹å‡»"Manage Plugins"
3. æœç´¢å¹¶å®‰è£…ä»¥ä¸‹æ’ä»¶ï¼š
   - **Git Plugin**
   - **Pipeline Plugin**
   - **SSH Agent Plugin**
   - **Email Extension Plugin**
   - **Timestamper Plugin**
4. å®‰è£…å®Œæˆåé‡å¯Jenkins

### 1.3 é…ç½®å…¨å±€å·¥å…·

1. è¿›å…¥"Manage Jenkins" â†’ "Global Tool Configuration"

#### é…ç½®JDK
1. æ‰¾åˆ°"JDK"éƒ¨åˆ†
2. ç‚¹å‡»"JDKå®‰è£…"
3. å¡«å†™ï¼š
   - Nameï¼š`JDK11`
   - JAVA_HOMEï¼š`/usr/lib/jvm/java-11-openjdk`
   - Javaç‰ˆæœ¬ï¼š`11.0.x`
4. ç‚¹å‡»"ä¿å­˜"

#### é…ç½®Maven
1. åœ¨åŒä¸€é¡µé¢æ‰¾åˆ°"Maven"éƒ¨åˆ†
2. ç‚¹å‡»"Mavenå®‰è£…"
3. å¡«å†™ï¼š
   - Nameï¼š`Maven3.8`
   - MAVEN_HOMEï¼š`/opt/maven`
   - Mavenç‰ˆæœ¬ï¼š`3.8.6`
4. ç‚¹å‡»"ä¿å­˜"

#### é…ç½®Node.js
1. åœ¨åŒä¸€é¡µé¢æ‰¾åˆ°"Node.js"éƒ¨åˆ†
2. ç‚¹å‡»"Node.jså®‰è£…"
3. å¡«å†™ï¼š
   - Nameï¼š`Node18`
   - è‡ªåŠ¨å®‰è£…ï¼šå‹¾é€‰
   - Node.jsç‰ˆæœ¬ï¼š`18.x`
4. ç‚¹å‡»"ä¿å­˜"

---

## å‡­æ®ç®¡ç†

### 2.1 æ·»åŠ æœåŠ¡å™¨å¯†ç å‡­æ®

1. è¿›å…¥"Manage Jenkins" â†’ "Manage Credentials"
2. ç‚¹å‡»"Global credentials (unrestricted)"
3. ç‚¹å‡»"Add Credentials"
4. å¡«å†™ä¿¡æ¯ï¼š
   - **ç±»å‹**ï¼šé€‰æ‹©"Username with password"
   - **Scope**ï¼šé€‰æ‹©"Global (Jenkins, nodes, items, all child items, etc)"
   - **Username**ï¼š`root`
   - **Password**ï¼šè¾“å…¥æ‚¨çš„æœåŠ¡å™¨rootå¯†ç 
   - **ID**ï¼š`server-password`
   - **Description**ï¼š`ç”Ÿäº§æœåŠ¡å™¨rootå¯†ç `
5. ç‚¹å‡»"Create"

### 2.2 æ·»åŠ GitHubå‡­æ®

1. åœ¨åŒä¸€é¡µé¢ç»§ç»­ç‚¹å‡»"Add Credentials"
2. å¡«å†™ä¿¡æ¯ï¼š
   - **ç±»å‹**ï¼šé€‰æ‹©"Username with password"
   - **Scope**ï¼šé€‰æ‹©"Global"
   - **Username**ï¼š`624140273@qq.com`
   - **Password**ï¼š`135138785322qw`
   - **ID**ï¼š`github-credentials`
   - **Description**ï¼š`GitHubè´¦å·å¯†ç `
3. ç‚¹å‡»"Create"

### 2.3 æ·»åŠ Webhookå¯†é’¥

1. åœ¨åŒä¸€é¡µé¢ç»§ç»­ç‚¹å‡»"Add Credentials"
2. å¡«å†™ä¿¡æ¯ï¼š
   - **ç±»å‹**ï¼šé€‰æ‹©"Secret text"
   - **Scope**ï¼šé€‰æ‹©"Global"
   - **Secret**ï¼š`smart-order-hub-webhook-secret`
   - **ID**ï¼š`github-webhook-secret`
   - **Description**ï¼š`GitHub Webhookå¯†é’¥`
3. ç‚¹å‡»"Create"

**é‡è¦æç¤º**ï¼šè¯·è®°ä½è¿™ä¸ªå¯†é’¥`smart-order-hub-webhook-secret`ï¼Œé…ç½®GitHub webhookæ—¶éœ€è¦ä½¿ç”¨

---

## åˆ›å»ºéƒ¨ç½²ä»»åŠ¡

### 3.1 åˆ›å»ºæ–°ä»»åŠ¡

1. è¿”å›Jenkinsé¦–é¡µ
2. ç‚¹å‡»å·¦ä¾§"æ–°å»ºä»»åŠ¡"
3. è¾“å…¥ä»»åŠ¡åç§°ï¼š`smart-order-hub-prod`
4. é€‰æ‹©ä»»åŠ¡ç±»å‹ï¼šç‚¹å‡»"æµæ°´çº¿ï¼ˆPipelineï¼‰"
5. ç‚¹å‡»"ç¡®å®š"

### 3.2 é…ç½®General

åœ¨ä»»åŠ¡é…ç½®é¡µé¢ï¼š

1. **æè¿°**ï¼š
   ```
   æ™ºèƒ½ç‚¹é¤ç³»ç»Ÿ - ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨éƒ¨ç½²
   ```

2. **ä¸¢å¼ƒæ—§çš„æ„å»º**ï¼š
   - å‹¾é€‰"Discard old builds"
   - ä¿æŒæ„å»ºä¸ªæ•°ï¼š`10`
   - å¤©æ•°ï¼š`30`

### 3.3 é…ç½®æ„å»ºè§¦å‘å™¨

#### é€‰é¡¹Aï¼šGitHub webhookè§¦å‘ï¼ˆæ¨èï¼‰

1. åœ¨"æ„å»ºè§¦å‘å™¨"éƒ¨åˆ†
2. å‹¾é€‰"GitHub hook trigger for GITScm polling"
3. **GitHub hook URL**ï¼š`http://<Jenkinså…¬ç½‘IPæˆ–åŸŸå>/github-webhook/`
   - ç¤ºä¾‹ï¼š`http://106.15.90.212:8080/github-webhook/`
4. **Secret**ï¼š`smart-order-hub-webhook-secret`ï¼ˆä¸å‡­æ®ä¸­çš„IDä¸€è‡´ï¼‰
5. ç‚¹å‡»"ä¿å­˜"

#### é€‰é¡¹Bï¼šå®šæ—¶æ„å»ºï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å®šæ—¶æ„å»ºï¼š

1. å‹¾é€‰"Build periodically"
2. è¾“å…¥Cronè¡¨è¾¾å¼ï¼š
   - `H/30 * * * *` - æ¯30åˆ†é’Ÿæ„å»ºä¸€æ¬¡
   - `H 2 * * *` - æ¯å¤©å‡Œæ™¨2ç‚¹æ„å»º
   - `H H(9-18) * * 1-5` - å·¥ä½œæ—¥æ¯å°æ—¶æ„å»º

### 3.4 é…ç½®Pipeline

åœ¨"Pipeline"éƒ¨åˆ†ï¼š

1. **Definition**ï¼šé€‰æ‹©"Pipeline script from SCM"
2. **SCM**ï¼šé€‰æ‹©"Git"
3. **Repository URL**ï¼š`https://github.com/lpf2025/smart_order_hub.git`
4. **Credentials**ï¼šé€‰æ‹©`github-credentials`ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œç‚¹å‡»"Add"æ·»åŠ ï¼‰
5. **Branches to build**ï¼š`*/main`
6. **Script Path**ï¼š`Jenkinsfile`
7. **Lightweight checkout**ï¼šå‹¾é€‰ï¼ˆåŠ å¿«æ£€å‡ºé€Ÿåº¦ï¼‰

### 3.5 ä¿å­˜é…ç½®

1. æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
2. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
3. ç‚¹å‡»"åº”ç”¨"æŒ‰é’®

---

## é…ç½®GitHub Webhook

### 4.1 è¿›å…¥GitHubä»“åº“è®¾ç½®

1. è®¿é—®ï¼šhttps://github.com/lpf2025/smart_order_hub/settings/hooks
2. ç‚¹å‡»"Add webhook"æŒ‰é’®

### 4.2 é…ç½®Webhook

1. **Payload URL**ï¼š
   ```
   http://<Jenkinså…¬ç½‘IPæˆ–åŸŸå>/github-webhook/
   ```
   - ç¤ºä¾‹ï¼š`http://106.15.90.212:8080/github-webhook/`

2. **Content type**ï¼šé€‰æ‹©`application/json`

3. **Secret**ï¼š
   ```
   smart-order-hub-webhook-secret
   ```
   - å¿…é¡»ä¸Jenkinså‡­æ®ä¸­çš„Secretå®Œå…¨ä¸€è‡´

4. **Which events would you like to trigger this webhook?**
   - å‹¾é€‰"Just the push event"
   - å‹¾é€‰"Branch or tag creation"

5. **Active**ï¼šå‹¾é€‰"Active"

6. ç‚¹å‡»"Add webhook"æŒ‰é’®

### 4.3 éªŒè¯Webhook

1. åœ¨webhookåˆ—è¡¨ä¸­æŸ¥çœ‹åˆšåˆ›å»ºçš„webhook
2. ç‚¹å‡»"..."æŸ¥çœ‹æœ€è¿‘äº¤ä»˜è®°å½•
3. åº”è¯¥æ˜¾ç¤º"200 OK"çŠ¶æ€

---

## æœåŠ¡å™¨åˆå§‹åŒ–

### 5.1 ä¸Šä¼ åˆå§‹åŒ–è„šæœ¬

åœ¨æ‚¨çš„æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼š

```bash
# 1. ä¸Šä¼ åˆå§‹åŒ–è„šæœ¬åˆ°æœåŠ¡å™¨
scp scripts/server-init.sh root@106.15.90.212:/tmp/
```

### 5.2 æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

```bash
# 2. SSHç™»å½•åˆ°æœåŠ¡å™¨
ssh root@106.15.90.212

# 3. æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
bash /tmp/server-init.sh
```

### 5.3 éªŒè¯åˆå§‹åŒ–

åˆå§‹åŒ–è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š

1. âœ… æ›´æ–°ç³»ç»Ÿ
2. âœ… å®‰è£…Java 11
3. âœ… å®‰è£…Maven 3.8
4. âœ… å®‰è£…Node.js 18
5. âœ… é…ç½®npmæ·˜å®é•œåƒ
6. âœ… å®‰è£…sshpass
7. âœ… åˆ›å»ºéƒ¨ç½²ç›®å½•
8. âœ… é…ç½®é˜²ç«å¢™
9. âœ… é…ç½®Nginx
10. âœ… é‡å¯NginxæœåŠ¡

éªŒè¯å‘½ä»¤ï¼š

```bash
# æ£€æŸ¥Javaç‰ˆæœ¬
java -version

# æ£€æŸ¥Mavenç‰ˆæœ¬
mvn -version

# æ£€æŸ¥Node.jsç‰ˆæœ¬
node -v

# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx

# æ£€æŸ¥é˜²ç«å¢™
firewall-cmd --list-all
```

---

## é¦–æ¬¡æ„å»º

### 6.1 æ‰‹åŠ¨è§¦å‘æ„å»º

1. è¿”å›Jenkinsé¦–é¡µ
2. æ‰¾åˆ°ä»»åŠ¡"smart-order-hub-prod"
3. ç‚¹å‡»"ç«‹å³æ„å»º"æŒ‰é’®

### 6.2 æŸ¥çœ‹æ„å»ºæ—¥å¿—

1. ç‚¹å‡»æ„å»ºå·è¿›å…¥æ„å»ºè¯¦æƒ…é¡µ
2. ç‚¹å‡»"Console Output"æ ‡ç­¾æŸ¥çœ‹å®æ—¶æ—¥å¿—

### 6.3 æ„å»ºæµç¨‹è¯´æ˜

Jenkinsä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

#### é˜¶æ®µ1ï¼šä»£ç æ£€å‡º
- ä»GitHubæ£€å‡ºä»£ç 
- æ£€å‡ºmainåˆ†æ”¯æœ€æ–°ä»£ç 

#### é˜¶æ®µ2ï¼šç¯å¢ƒæ£€æŸ¥
- æ£€æŸ¥Javaç‰ˆæœ¬
- æ£€æŸ¥Mavenç‰ˆæœ¬
- æ£€æŸ¥Node.jsç‰ˆæœ¬
- æ£€æŸ¥npmç‰ˆæœ¬

#### é˜¶æ®µ3ï¼šåç«¯æ‰“åŒ…
- è¿›å…¥backendç›®å½•
- æ‰§è¡Œ`mvn clean package -DskipTests`
- ç”ŸæˆjaråŒ…ï¼š`backend/target/smart-order-hub-1.0.0.jar`

#### é˜¶æ®µ4ï¼šå‰ç«¯æ‰“åŒ…
- è¿›å…¥pc-adminç›®å½•
- æ‰§è¡Œ`npm install`
- æ‰§è¡Œ`npm run build`
- ç”Ÿæˆé™æ€æ–‡ä»¶ï¼š`pc-admin/dist/`

#### é˜¶æ®µ5ï¼šéƒ¨ç½²åç«¯
- ä½¿ç”¨SCPä¸Šä¼ jaråŒ…åˆ°æœåŠ¡å™¨
- ä¸Šä¼ å¯åŠ¨è„šæœ¬åˆ°æœåŠ¡å™¨
- åœæ­¢æ—§æœåŠ¡
- å¯åŠ¨æ–°æœåŠ¡

#### é˜¶æ®µ6ï¼šéƒ¨ç½²å‰ç«¯
- ä½¿ç”¨SCPä¸Šä¼ é™æ€æ–‡ä»¶åˆ°æœåŠ¡å™¨
- æ¸…ç©ºæ—§æ–‡ä»¶
- è®¾ç½®æ–‡ä»¶æƒé™

#### é˜¶æ®µ7ï¼šå¥åº·æ£€æŸ¥
- ç­‰å¾…30ç§’è®©æœåŠ¡å¯åŠ¨
- æ£€æŸ¥åç«¯APIï¼š`http://106.15.90.212:8081/api/health`
- æ£€æŸ¥å‰ç«¯æœåŠ¡ï¼š`http://106.15.90.212/admin/`

#### é˜¶æ®µ8ï¼šæ¸…ç†æ„å»º
- æ¸…ç†Jenkinså·¥ä½œç©ºé—´

### 6.4 éªŒè¯éƒ¨ç½²

æ„å»ºæˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯ï¼š

1. **å‰ç«¯ç®¡ç†åå°**ï¼š
   ```
   http://106.15.90.212/admin/
   ```
   - åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢

2. **åç«¯APIå¥åº·æ£€æŸ¥**ï¼š
   ```
   http://106.15.90.212:8081/api/health
   ```
   - åº”è¯¥è¿”å›JSONæ•°æ®ï¼š
     ```json
     {
       "code": 200,
       "data": {
         "status": "UP",
         "timestamp": "2026-01-20T10:00:00",
         "application": "smart-order-hub",
         "version": "1.0.0"
       }
     }
     ```

---

## æ—¥å¸¸æ“ä½œ

### 7.1 ä»£ç æäº¤åè‡ªåŠ¨éƒ¨ç½²

é…ç½®äº†GitHub webhookåï¼Œæ¯æ¬¡æ¨é€ä»£ç åˆ°mainåˆ†æ”¯ï¼š

1. å¼€å‘äººå‘˜æäº¤ä»£ç 
2. æ¨é€åˆ°GitHub
3. GitHubè‡ªåŠ¨è§¦å‘Jenkinsæ„å»º
4. Jenkinsè‡ªåŠ¨æ‰§è¡Œæ‰“åŒ…å’Œéƒ¨ç½²
5. éƒ¨ç½²å®Œæˆåå‘é€é‚®ä»¶é€šçŸ¥

### 7.2 æ‰‹åŠ¨è§¦å‘æ„å»º

å¦‚æœéœ€è¦æ‰‹åŠ¨éƒ¨ç½²ï¼š

1. è¿›å…¥Jenkinsé¦–é¡µ
2. æ‰¾åˆ°ä»»åŠ¡"smart-order-hub-prod"
3. ç‚¹å‡»"ç«‹å³æ„å»º"
4. æŸ¥çœ‹æ„å»ºæ—¥å¿—

### 7.3 æŸ¥çœ‹æ„å»ºå†å²

1. è¿›å…¥ä»»åŠ¡é¡µé¢
2. ç‚¹å‡»"Build History"
3. æŸ¥çœ‹æ‰€æœ‰æ„å»ºè®°å½•
4. ç‚¹å‡»æ„å»ºå·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### 7.4 æŸ¥çœ‹æ„å»ºçŠ¶æ€

æ„å»ºçŠ¶æ€è¯´æ˜ï¼š

- ğŸ”µ **è“è‰²**ï¼šæ„å»ºä¸­
- ğŸ”µ **çº¢è‰²**ï¼šæ„å»ºå¤±è´¥
- ğŸ”´ **é»„è‰²**ï¼šæ„å»ºä¸ç¨³å®š
- ğŸŸ¢ **ç»¿è‰²**ï¼šæ„å»ºæˆåŠŸ

### 7.5 æŸ¥çœ‹æ„å»ºæ—¶é—´

- **æ„å»ºæ—¶é—´**ï¼šæ˜¾ç¤ºæ¯ä¸ªé˜¶æ®µçš„è€—æ—¶
- **æ€»è€—æ—¶**ï¼šæ˜¾ç¤ºæ•´ä¸ªæ„å»ºè¿‡ç¨‹çš„æ€»æ—¶é—´
- **å¹³å‡æ—¶é—´**ï¼šå¯ä»¥æŸ¥çœ‹å†å²æ„å»ºçš„å¹³å‡æ—¶é—´

---

## é—®é¢˜æ’æŸ¥

### 8.1 æ„å»ºå¤±è´¥

#### é—®é¢˜ï¼šMavenä¾èµ–ä¸‹è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
[ERROR] Failed to execute goal on project smart-order-hub: Could not resolve dependencies
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†Mavenç¼“å­˜
rm -rf ~/.m2/repository

# ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼ˆå·²åœ¨åˆå§‹åŒ–è„šæœ¬ä¸­é…ç½®ï¼‰
# é‡æ–°è§¦å‘æ„å»º
```

#### é—®é¢˜ï¼šnpm installå¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
npm ERR! network timeout
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†npmç¼“å­˜
npm cache clean --force

# ä½¿ç”¨æ·˜å®é•œåƒï¼ˆå·²åœ¨åˆå§‹åŒ–è„šæœ¬ä¸­é…ç½®ï¼‰
npm install --registry=https://registry.npm.taobao.org
```

#### é—®é¢˜ï¼šä»£ç æ£€å‡ºå¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ERROR: Error fetching remote repo 'origin'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥GitHubå‡­æ®æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æ£€æŸ¥ä»“åº“URLæ˜¯å¦æ­£ç¡®
4. é‡æ–°è§¦å‘æ„å»º

### 8.2 éƒ¨ç½²å¤±è´¥

#### é—®é¢˜ï¼šSSHè¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Permission denied (publickey,password)
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥å‡­æ®IDæ˜¯å¦æ­£ç¡®
# åœ¨Jenkinsä¸­æ£€æŸ¥server-passwordå‡­æ®

# æµ‹è¯•SSHè¿æ¥
ssh root@106.15.90.212 "echo 'è¿æ¥æˆåŠŸ'"

# æ£€æŸ¥é˜²ç«å¢™
firewall-cmd --list-all
```

#### é—®é¢˜ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Port 8081 is already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
lsof -ti:8081

# åœæ­¢è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä½¿ç”¨å¯åŠ¨è„šæœ¬è‡ªåŠ¨å¤„ç†
cd /opt/smart-order-hub/backend
./stop.sh
```

#### é—®é¢˜ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
scp: No such file or directory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥jaråŒ…æ˜¯å¦ç”Ÿæˆ
3. æ£€æŸ¥distç›®å½•æ˜¯å¦å­˜åœ¨
4. é‡æ–°è§¦å‘æ„å»º

### 8.3 æœåŠ¡å¯åŠ¨å¤±è´¥

#### é—®é¢˜ï¼šJavaå†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
java.lang.OutOfMemoryError: Java heap space
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

ä¿®æ”¹[Jenkinsfile](file:///d:/git/smart_rder_hub/Jenkinsfile)ä¸­çš„å¯åŠ¨å‘½ä»¤ï¼š

```groovy
stage('éƒ¨ç½²åç«¯') {
    steps {
        sh """
            # å¢åŠ JVMå†…å­˜å‚æ•°
            nohup java -Xms512m -Xmx1024m \\
                -jar $JAR_NAME \\
                --spring.profiles.active=prod \\
                > /var/log/smart-order-hub/app.log 2>&1 &
        """
    }
}
```

#### é—®é¢˜ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Communications link failure
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h rm-uf6fjt8k75xbfc1phso.mysql.rds.aliyuncs.com -u root -p

# æ£€æŸ¥é˜²ç«å¢™
firewall-cmd --list-all

# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat /opt/smart-order-hub/backend/application-prod.yml
```

### 8.4 å¥åº·æ£€æŸ¥å¤±è´¥

#### é—®é¢˜ï¼šåç«¯APIæ— æ³•è®¿é—®

**é”™è¯¯ä¿¡æ¯**ï¼š
```
curl: (7) Failed to connect
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
ps aux | grep smart-order-hub

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 8081

# æŸ¥çœ‹æ—¥å¿—
tail -100 /var/log/smart-order-hub/app.log

# æ‰‹åŠ¨é‡å¯æœåŠ¡
cd /opt/smart-order-hub/backend
./stop.sh
./start.sh
```

#### é—®é¢˜ï¼šå‰ç«¯é¡µé¢404

**é”™è¯¯ä¿¡æ¯**ï¼š
```
404 Not Found
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥Nginxé…ç½®
nginx -t

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/www/admin/

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/admin/index.html

# é‡æ–°åŠ è½½Nginx
nginx -s reload
```

---

## é«˜çº§æ“ä½œ

### 9.1 å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@106.15.90.212

# è¿›å…¥éƒ¨ç½²ç›®å½•
cd /opt/smart-order-hub/backend

# æ¢å¤å¤‡ä»½
mv smart-order-hub-1.0.0.jar.backup smart-order-hub-1.0.0.jar

# é‡å¯æœåŠ¡
./stop.sh
./start.sh
```

### 9.2 æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /var/log/smart-order-hub/app.log

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
journalctl -u jenkins -f
```

### 9.3 æ¸…ç†æ—§æ„å»º

Jenkinsä¼šè‡ªåŠ¨æ¸…ç†æ—§æ„å»ºï¼Œä½†ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…ç†ï¼š

1. è¿›å…¥ä»»åŠ¡é…ç½®
2. å‹¾é€‰"Discard old builds"
3. è®¾ç½®ä¿æŒæ„å»ºä¸ªæ•°ï¼š`10`
4. è®¾ç½®å¤©æ•°ï¼š`30`

### 9.4 é…ç½®å¤šç¯å¢ƒ

å¦‚æœéœ€è¦å¤šç¯å¢ƒéƒ¨ç½²ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰ï¼š

1. åˆ›å»ºå¤šä¸ªJenkinsä»»åŠ¡ï¼š
   - `smart-order-hub-dev` - å¼€å‘ç¯å¢ƒ
   - `smart-order-hub-test` - æµ‹è¯•ç¯å¢ƒ
   - `smart-order-hub-prod` - ç”Ÿäº§ç¯å¢ƒ

2. æ¯ä¸ªä»»åŠ¡ä½¿ç”¨ä¸åŒçš„é…ç½®ï¼š
   - ä¸åŒçš„æœåŠ¡å™¨IP
   - ä¸åŒçš„éƒ¨ç½²è·¯å¾„
   - ä¸åŒçš„æ•°æ®åº“

---

## é™„å½•

### A. Jenkinsfileå®Œæ•´è·¯å¾„

```
https://github.com/lpf2025/smart_order_hub/blob/main/Jenkinsfile
```

### B. æœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬è·¯å¾„

```
https://github.com/lpf2025/smart_order_hub/blob/main/scripts/server-init.sh
```

### C. åç«¯å¯åŠ¨è„šæœ¬è·¯å¾„

```
https://github.com/lpf2025/smart_order_hub/blob/main/scripts/backend-start.sh
```

### D. åç«¯åœæ­¢è„šæœ¬è·¯å¾„

```
https://github.com/lpf2025/smart_order_hub/blob/main/scripts/backend-stop.sh
```

### E. å¸¸ç”¨ç«¯å£

| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| Jenkins | 8080 | Jenkins Webç•Œé¢ |
| åç«¯API | 8081 | åç«¯æœåŠ¡ |
| å‰ç«¯ | 80 | HTTPè®¿é—® |
| SSH | 22 | è¿œç¨‹è¿æ¥ |
| MySQL | 3306 | æ•°æ®åº“ |

---

## å¿«é€Ÿå‚è€ƒ

### é¦–æ¬¡éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] Jenkinså·²å®‰è£…å¹¶è¿è¡Œ
- [ ] å¿…è¦æ’ä»¶å·²å®‰è£…
- [ ] å…¨å±€å·¥å…·å·²é…ç½®
- [ ] å‡­æ®å·²åˆ›å»º
- [ ] Jenkinsä»»åŠ¡å·²åˆ›å»º
- [ ] GitHub webhookå·²é…ç½®
- [ ] æœåŠ¡å™¨å·²åˆå§‹åŒ–
- [ ] é¦–æ¬¡æ„å»ºæˆåŠŸ
- [ ] å‰ç«¯å¯ä»¥è®¿é—®
- [ ] åç«¯APIæ­£å¸¸

### æ—¥å¸¸éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²æäº¤åˆ°GitHub
- [ ] Jenkinsæ„å»ºå·²è§¦å‘
- [ ] æ„å»ºæˆåŠŸ
- [ ] éƒ¨ç½²æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

---

## æ€»ç»“

æŒ‰ç…§æœ¬æ–‡æ¡£æ“ä½œå®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š

âœ… **å®Œå…¨è‡ªåŠ¨åŒ–çš„éƒ¨ç½²æµç¨‹**
âœ… **ä¸€é”®å®Œæˆæ‰“åŒ…ã€ä¸Šä¼ ã€éƒ¨ç½²**
âœ… **ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šèƒ½åŠ›**
âœ… **å®æ—¶ç›‘æ§å’Œé‚®ä»¶é€šçŸ¥**
âœ… **è¯¦ç»†çš„æ„å»ºæ—¥å¿—å’Œå†å²è®°å½•**

æ‰€æœ‰é…ç½®æ–‡ä»¶å·²æ¨é€åˆ°GitHubï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼
